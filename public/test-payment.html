<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Payment System Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      margin-bottom: 30px;
    }
    .test-section {
      margin: 20px 0;
      padding: 20px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
    }
    button {
      background: #3b82f6;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      margin: 5px;
    }
    button:hover {
      background: #2563eb;
    }
    .result {
      margin-top: 15px;
      padding: 15px;
      background: #f9fafb;
      border-radius: 6px;
      font-family: monospace;
      font-size: 12px;
      white-space: pre-wrap;
      word-break: break-all;
    }
    .success {
      color: #059669;
      font-weight: bold;
    }
    .error {
      color: #dc2626;
      font-weight: bold;
    }
    #qrDisplay {
      margin-top: 20px;
      text-align: center;
    }
    #qrDisplay img {
      max-width: 300px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      padding: 10px;
      background: white;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üß™ Payment System Browser Test</h1>

    <div class="test-section">
      <h2>üì± Test 1: Generate QRIS</h2>
      <p>Generate QRIS QR code with amount</p>
      <button onclick="testQRISGeneration()">Generate QRIS Rp 50.000</button>
      <div id="qrisResult" class="result" style="display:none;"></div>
      <div id="qrDisplay"></div>
    </div>

    <div class="test-section">
      <h2>üìã Test 2: Test Payment Service</h2>
      <p>Test payment service functions</p>
      <button onclick="testPaymentService()">Get Payment Methods</button>
      <div id="serviceResult" class="result" style="display:none;"></div>
    </div>

    <div class="test-section">
      <h2>üîç Test 3: Console Access</h2>
      <p>Copy and paste this in browser console:</p>
      <div class="result">
// Import functions from modules
import { generateQRISImage } from '/src/lib/payment/qris-generator';

// Test QRIS generation
const qrisImage = await generateQRISImage({
  merchantName: 'AGDS Corp',
  merchantCity: 'Jakarta',
  amount: 50000,
  transactionId: 'TEST-123'
}, { width: 400 });

console.log('‚úÖ QRIS Generated!');
console.log(qrisImage.substring(0, 100) + '...');
      </div>
    </div>
  </div>

  <script type="module">
    // Import payment utilities
    import { generateQRISImage, generateQRISString, validateQRIS } from '/src/lib/payment/qris-generator.js';
    import { getActivePaymentMethods } from '/src/lib/payment/payment-service.js';

    // Make functions available globally for button clicks
    window.testQRISGeneration = async function() {
      const resultDiv = document.getElementById('qrisResult');
      const qrDiv = document.getElementById('qrDisplay');

      try {
        resultDiv.style.display = 'block';
        resultDiv.innerHTML = '‚è≥ Generating QRIS...';

        const config = {
          merchantName: 'AGDS Corp',
          merchantCity: 'Jakarta',
          amount: 50000,
          transactionId: 'TEST-' + Date.now()
        };

        // Generate QRIS string
        const qrisString = generateQRISString(config);

        // Validate
        const isValid = validateQRIS(qrisString);

        // Generate QR image
        const qrisImage = await generateQRISImage(config, { width: 300 });

        resultDiv.innerHTML = `<span class="success">‚úÖ QRIS Generated Successfully!</span>

QRIS String:
${qrisString}

Validation: ${isValid ? '‚úÖ VALID' : '‚ùå INVALID'}
Length: ${qrisString.length} characters
Transaction: ${config.transactionId}
Amount: Rp ${config.amount.toLocaleString('id-ID')}`;

        // Display QR code
        qrDiv.innerHTML = `<h3>Scan this QR Code:</h3><img src="${qrisImage}" alt="QRIS QR Code">`;

      } catch (error) {
        resultDiv.innerHTML = `<span class="error">‚ùå Error:</span>\n${error.message}\n\n${error.stack}`;
        qrDiv.innerHTML = '';
      }
    };

    window.testPaymentService = async function() {
      const resultDiv = document.getElementById('serviceResult');

      try {
        resultDiv.style.display = 'block';
        resultDiv.innerHTML = '‚è≥ Fetching payment methods...';

        const methods = await getActivePaymentMethods();

        resultDiv.innerHTML = `<span class="success">‚úÖ Payment Methods Retrieved!</span>

Found ${methods.length} active payment methods:

${methods.map((m, i) => `${i + 1}. ${m.name} (${m.type})
   Code: ${m.code}
   Active: ${m.is_active ? '‚úÖ' : '‚ùå'}
   Requires Confirmation: ${m.requires_confirmation ? 'Yes' : 'No'}`).join('\n\n')}`;

      } catch (error) {
        resultDiv.innerHTML = `<span class="error">‚ùå Error:</span>\n${error.message}\n\n${error.stack}`;
      }
    };

    // Make functions available in console
    window.generateQRISImage = generateQRISImage;
    window.generateQRISString = generateQRISString;
    window.validateQRIS = validateQRIS;
    window.getActivePaymentMethods = getActivePaymentMethods;

    console.log('‚úÖ Payment System Test Page Loaded!');
    console.log('Available functions:');
    console.log('  - generateQRISImage(config, options)');
    console.log('  - generateQRISString(config)');
    console.log('  - validateQRIS(qrisString)');
    console.log('  - getActivePaymentMethods()');
  </script>
</body>
</html>
